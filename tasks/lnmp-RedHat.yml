- name: Configure PHP-FPM
  template:
    src: www.conf.jinja2
    dest: /etc/php-fpm.d/www.conf

- name: Restart PHP-FPM
  service:
    name: php-fpm
    state: restarted
    enabled: yes

- name: Create extra Dir
  file:
    path: /etc/nginx/extra
    state: directory

- name: Support PHP
  copy:
    src: nginx-php.conf
    dest: /etc/nginx/extra/php.conf

- name: Copy Default Vhost config and rewrite
  copy: 
    src: "{{item.src}}" 
    dest: "{{item.dest}}"
  with_items:
    - {src: nginx-default-php.conf, dest: /etc/nginx/conf.d/default.conf}
    - {src: rewrite, dest: /etc/nginx/conf.d}

- name: Restart Nginx
  service:
    name: nginx
    state: restarted
